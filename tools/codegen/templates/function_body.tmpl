#ifdef FLEXIBLAS_HOOK_API
static TLS_STORE uint8_t hook_pos_{function_name:s} = 0;
#endif

/* Wrapper for {function_name:s} */
{return_type:s} FC_GLOBAL({function_name:s},{FUNCTION_NAME:s})
    ({arg_list:s})
{{
    {return_type:s} (*fn) ({arg_list_void:s});
    #ifdef FLEXIBLAS_HOOK_API
    {return_type:s} (*fn_hook) ({arg_list_void:s});
    hook_pos_{function_name:s} = 0;
    #endif
    {return_type:s} ret;

    /* Post init if necessary */
    if ( unlikely(current_backend->post_init != 0) ) {{
        __flexiblas_backend_init(current_backend);
        current_backend->post_init = 0;
    }}

    *(void **) &fn = current_backend->{component:s}.{function_name:s};
    #ifdef FLEXIBLAS_HOOK_API
    *(void **) &fn_hook = __flexiblas_hooks->{function_name:s}.hook_function[0];

    if ( fn_hook != NULL ) {{
        ret = fn_hook({call_list_void:s});
    }} else {{
        ret = fn({call_list_void:s});
    }}
    #else
    ret = fn({call_list_void:s});
    #endif
    return ret;
}}

#ifndef __APPLE__
{return_type:s} FC_GLOBAL2({function_name:s},{FUNCTION_NAME:s})({arg_list:s}) __attribute__((alias(MTS(FC_GLOBAL({function_name:s},{FUNCTION_NAME:s})))));
{return_type:s} FC_GLOBAL3({function_name:s},{FUNCTION_NAME:s})({arg_list:s}) __attribute__((alias(MTS(FC_GLOBAL({function_name:s},{FUNCTION_NAME:s})))));
#else
{return_type:s} FC_GLOBAL2({function_name:s},{FUNCTION_NAME:s})({arg_list:s})
{{
    return FC_GLOBAL({function_name:s},{FUNCTION_NAME:s})({call_list_void:s});
}}
{return_type:s} FC_GLOBAL3({function_name:s},{FUNCTION_NAME:s})({arg_list:s})
{{
    return FC_GLOBAL({function_name:s},{FUNCTION_NAME:s})({call_list_void:s});
}}
#endif


#ifdef FLEXIBLAS_HOOK_API
{return_type:s} flexiblas_real_{function_name:s}_({arg_list_void:s})
{{
    {return_type:s} (*fn) ({arg_list_void:s});
    {return_type:s} ret;
    *(void **) &fn = current_backend->{component:s}.{function_name:s};
    ret = fn({call_list_void:s});
    return ret;
}}
#ifndef __APPLE__
{return_type:s} flexiblas_real_{function_name:s}({arg_list_void:s}) __attribute__((alias("flexiblas_real_{function_name:s}_")));
#else
{return_type:s} flexiblas_real_{function_name:s}({arg_list_void:s})
{{
    return flexiblas_real_{function_name:s}_({call_list_void:s});
}}
#endif

{return_type:s} flexiblas_chain_{function_name:s}_({arg_list_void:s})
{{
    {return_type:s} (*fn) ({arg_list_void:s});
    {return_type:s} ret;
    hook_pos_{function_name:s}++;
    if ( hook_pos_{function_name:s} < __flexiblas_hooks->{function_name:s}.nhook ) {{
        *(void **) &fn = __flexiblas_hooks->{function_name:s}.hook_function[hook_pos_{function_name:s}];
    }} else {{
        hook_pos_{function_name:s} = 0;
        *(void **) &fn = current_backend->{component:s}.{function_name:s};
    }}
    ret = fn({call_list_void:s});
    return ret;
}}
#ifndef __APPLE__
{return_type:s} flexiblas_chain_{function_name:s}({arg_list_void:s}) __attribute__((alias("flexiblas_chain_{function_name:s}_")));
#else
{return_type:s} flexiblas_chain_{function_name:s}({arg_list_void:s})
{{
    return flexiblas_chain_{function_name:s}_({call_list_void:s});
}}
#endif


#endif
